"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7011],{9015:(L,_,u)=>{u.d(_,{Dp:()=>g,Ge:()=>l,xw:()=>a});var g=(()=>{return(s=g||(g={}))[s.Anomalies=-1]="Anomalies",s[s.Activated=0]="Activated",s[s.Pause=1]="Pause",s[s.Stop=2]="Stop",s[s.WaitingToRun=3]="WaitingToRun",g;var s})(),a=(()=>{return(s=a||(a={})).ipUnbound="ipUnbound",s.OffPlatformTransfers="OffPlatformTransfers",s.OffPlatformTrading="OffPlatformTrading",s.VipInstantExpire="VipInstantExpire",s.HashPowerNotEnough="HashPowerNotEnough",s.AccountContractDisabled="accountContractDisabled",a;var s})(),l=(()=>{return(s=l||(l={})).Running="Running",s.Stopped="Stopped",s.Inprogress="Inprogress",s.None="None",s.ProbablyStop="ProbablyStop",l;var s})()},7011:(L,_,u)=>{u.d(_,{k:()=>U});var g=u(655),i=u(2340),d=u(1135),a=u(4004),f=u(8505),l=u(9808),s=u(4128),c=u(9015),$=u(4650),A=u(529),R=u(7179),E=u(3416);let U=(()=>{class h{constructor(t,e,r){this.http=t,this.storage=e,this.i18n=r,this.strategies$=new d.X([]),this.currentStrategy$=new d.X(null),this.currentStrategyInternation$=new d.X(null),this.translatedinfo$=new d.X(null),this.activatedStrategyInfo=new d.X({}),this.lastVisitedStrategy=null,this.checkStrategyActive$=new d.X({IsActivate:!1,IsHashCheck:!1,IsSubCountCheck:!1,IsVipCheck:!1,isInvestCheck:!1,residueInvest:0}),this.count=0,r.onLangChange.subscribe(()=>{this.updateCurrentStrategyInternation()})}setLastVisitedStrategy(t){return(0,g.mG)(this,void 0,void 0,function*(){this.lastVisitedStrategy=t,yield this.storage.set("last_visit_strategy",t)})}getLastVisitedStrategy(){return(0,g.mG)(this,void 0,void 0,function*(){return this.lastVisitedStrategy||(this.lastVisitedStrategy=yield this.storage.get("last_visit_strategy")),this.lastVisitedStrategy})}getRealStrategyPageList(t){return this.http.get(`${i.N.BASE_URL}/strategy/getRealStrategyPageList?page=${t.page}&rows=${t.rows}&isLike=${t.isLike}&isSub=${t.isSub}&sortOrder=${t.sortOrder}&sortBy=${t.sortBy}&companyId=${t.companyId}`).pipe((0,a.U)(({data:e})=>e),(0,f.b)(e=>{this.strategies$.next((null==e?void 0:e.rows)||[])}))}queryCustomer(t,e){return this.http.get(`${i.N.BASE_URL}/real/queryCustomer?page=${t}&rows=${e}`)}buyStrategy(t){return this.http.post(`${i.N.BASE_URL}/user/buy/strategy`,t)}queryExtension(t){return this.http.get(`${i.N.BASE_URL}/real/queryExtension?realId=${t}`)}getRealSubscriptionLog(t,e,r){return this.http.get(`${i.N.BASE_URL}/strategy/getRealSubscriptionLog?subscriptionId=${r}&page=${t}&rows=${e}`)}getRealStrategyIndexProfitLine(t){let e=`${i.N.BASE_URL}/strategy/getRealStrategyIndexProfitLineDesc?runId=${t.runId}&type=${t.type}&limit=${t.limit}&startDate=${t.startDate}&sellId=${t.sellId}`;return t.endDate&&(e+=`&endDate=${t.endDate}`),this.http.get(e).pipe((0,a.U)(({data:r})=>r))}getRealTrade(t){return this.http.post(`${i.N.BASE_URL}/strategy/getRealTrade`,Object.assign({},t)).pipe((0,a.U)(({data:e})=>e))}getHistoryTime(t){return this.http.get(`${i.N.BASE_URL}/strategy/getHistoryTime`,{params:{sellId:t}}).pipe((0,a.U)(({data:e})=>e))}getRealCustomLog(t,e=0,r=1e3){return this.http.get(`${i.N.BASE_URL}/strategy/getRealCustomLog?runId=${t}&page=${e}&rows=${r}`)}subStrategyReal(t){return this.http.post(`${i.N.BASE_URL}/strategy/subStrategyReal`,Object.assign({},t)).pipe((0,a.U)(({data:e})=>e))}collectStrategyReal(t){const e=this.strategies$.getValue(),r=null==e?void 0:e.findIndex(n=>n.id===t.realId);return r>-1&&(e[r].likeNum=e[r].isLike?e[r].likeNum-1:e[r].likeNum+1,e[r].isLike=!e[r].isLike,this.strategies$.next([...e])),this.http.post(`${i.N.BASE_URL}/strategy/likeStrategyReal`,Object.assign({},t)).pipe((0,a.U)(({data:n})=>n))}queryMyRealStrategy(t){return this.http.get(`${i.N.BASE_URL}/strategy/queryMyRealStrategy?page=${t.page}&rows=${t.rows}&isLike=${t.isLike}&isSub=${t.isSub}&sortOrder=${t.sortOrder}&sortBy=${t.sortBy}`).pipe((0,a.U)(({data:e})=>e))}querySpecs(t){return this.http.get(`${i.N.BASE_URL}/v2/strategy/querySpecs?sellId=${t}`).pipe((0,a.U)(({data:e})=>e))}queryStrategyLabelList(){return this.http.get(`${i.N.BASE_URL}/v2/strategy/queryStrategyLabelList`).pipe((0,a.U)(({data:t})=>t))}getChartData(t){return this.http.get(`${i.N.BASE_URL}/strategy/getChartData?strategyId=${t}`)}stopStrategy(t,e){return this.http.post(`${i.N.BASE_URL}/strategy/stopStrategy`,{realId:t,IsClosePosition:e}).pipe((0,a.U)(({data:r})=>r))}editRiskControl(t){return this.http.post(`${i.N.BASE_URL}/strategy/editRiskControl`,Object.assign({},t)).pipe((0,a.U)(({data:e})=>e))}myAssets(){return this.http.get(`${i.N.BASE_URL}/strategy/myAssets`)}strategyHandling(t){return this.http.get(`${i.N.BASE_URL}/strategy/queryStrategyErr?runId=${t.runId}`).pipe((0,a.U)(({data:e})=>e))}queryStrategyDetails(t){return this.http.get(`${i.N.BASE_URL}/strategy/queryStrategyDetails?id=${t}`).pipe((0,a.U)(r=>(r.data&&(r.data.feRunStatus=this.getFeRunStatus(r.data)),r)),(0,f.b)(r=>{0==r.code&&r.data&&(this.activatedStrategyInfo.getValue(),this.cachedRunDetails(r.data.sellId,r.data))}))}cachedRunDetails(t,e){const r=this.activatedStrategyInfo.getValue();this.activatedStrategyInfo.next(Object.assign(Object.assign({},r),{[t]:e}))}checkActivate(t){return this.http.get(`${i.N.BASE_URL}/strategy/checkActivate?sellId=${t}`)}getRealStrategyPageListV2(t,e=!1){return this.http.get(`${i.N.BASE_URL}/v2/strategy/list?page=${t.page}&rows=${t.rows}&isLike=${t.isLike}&isSub=${t.isSub}&sortOrder=${t.sortOrder}&sortBy=${t.sortBy}&companyId=${t.companyId}&language=${t.language}&strategyName=${t.strategyName}&incomeDay=${t.incomeDay}&incomeRatio=${t.incomeRatio}&baseCurrency=${t.baseCurrency}`).pipe((0,a.U)(({data:r})=>(null!=r&&r.rows&&(r.rows=r.rows.map(n=>{let p=[];return n.accounts&&JSON.parse(n.accounts).forEach(I=>{p.push(I.symbolIcon)}),Object.assign(Object.assign({},n),{icons:p,isActivated:n.isSub,type:"automated"})})),r)),(0,f.b)(r=>(0,g.mG)(this,void 0,void 0,function*(){var n;if(e){this.strategies$.next((null==r?void 0:r.rows)||[]);for(let p=0;p<(null===(n=null==r?void 0:r.rows)||void 0===n?void 0:n.length);p++){const v=r.rows[p];v.isSub&&this.getActivatedStatusFromStrategyId(v.id)}}})))}getSubInfo(t){return this.http.get(`${i.N.BASE_URL}/v2/strategy/subInfo?sellId=${t}`)}getActivatedStatusFromStrategyId(t){return(0,g.mG)(this,void 0,void 0,function*(){if(this.activatedStrategyInfo.getValue()[t])return this.activatedStrategyInfo.getValue()[t];try{const{data:e}=yield(0,l.n)(this.getSubInfo(t));if(e)return(yield(0,l.n)(this.queryStrategyDetails(e.subId))).data||null}catch(e){return null}return null})}getRealStrategyProfitInfoV2(t){return this.http.get(`${i.N.BASE_URL}/v2/strategy/profit?sellId=${t}`)}getRealDetailByIdV2(t,e){return(0,g.mG)(this,void 0,void 0,function*(){const[r,n,p,v,I]=yield(0,l.n)((0,s.D)([this.http.get(`${i.N.BASE_URL}/v2/strategy/detail`,{params:{sellId:t,language:e}}),this.checkActivate(t),this.getSubInfo(t),this.getRealStrategyProfitInfoV2(t),this.querySpecs(t)])),y=r.data,o=p.data,S=v.data||{};this.checkStrategyActive$.next(n.data),this.currentStrategy$.next(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},y),o),{gmtCreate:y.gmtCreate,TeamRecommendationStopLoss:y.stopLoss,stopLoss:100*(null==o?void 0:o.stopLoss),teamName:y.company.companyName,companyId:y.company.companyId,companyAvatar:y.company.companyAvatar,dailyProfit:S.dp,maxMd:S.md,pr:S.pr,profitAmount:(null==o?void 0:o.totalProfit)||0,averageProfit:S.ap,runStatus:null==o?void 0:o.status,apr:S.apr}),y.subInfo),{myPr:null==o?void 0:o.pr,myApr:null==o?void 0:o.apr,accounts:y.subInfo.accounts?JSON.parse(y.subInfo.accounts):[],type:"automated",specs:I})),this.updateCurrentStrategyInternation()})}updateCurrentStrategyInternation(){var t;const e=null===(t=this.currentStrategy$.getValue())||void 0===t?void 0:t.specs;if(e&&e.i18n.length>0){const r=e.i18n.find(n=>Object.is(n.language,this.i18n.currentLang));r&&this.currentStrategyInternation$.next(r)}}queryBaseCurrency(){return this.http.get(`${i.N.BASE_URL}/v2/strategy/queryBaseCurrency`)}queryHistoricalProfit(t,e){return this.http.get(`${i.N.BASE_URL}/strategy/queryHistoricalProfit?runId=${t}&strategyType=${e}`)}getFeRunStatus(t){var e,r;const n=null==t?void 0:t.programStatus;return"running"===n?c.Ge.Running:"pre"!==n&&("pending"!==n||null!==(e=null==t?void 0:t.msg)&&void 0!==e&&e.length)?"pending"===n&&null!==(r=null==t?void 0:t.msg)&&void 0!==r&&r.length?c.Ge.Stopped:"kill"===n?c.Ge.None:"finish"===n||"exception"===n||"stopLoss"===n||"stopLossHandled"===n?c.Ge.Stopped:c.Ge.Inprogress:c.Ge.Inprogress}queryMyHistoricalMonthProfit(){return this.http.get(`${i.N.BASE_URL}/strategy/queryMyHistoricalMonthProfit`)}}return h.\u0275fac=function(t){return new(t||h)($.LFG(A.eN),$.LFG(R.V),$.LFG(E.sK))},h.\u0275prov=$.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);