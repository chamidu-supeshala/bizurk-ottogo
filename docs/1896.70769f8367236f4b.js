"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1896],{1896:(E,h,a)=>{a.d(h,{m:()=>U});var _=a(655),d=a(6895),e=a(4650),g=a(4006),c=a(8008),p=a(3416),l=a(7341),u=a(9116),x=a(8854),m=a(5379),M=a(2472),C=a(3709),O=a(6065);const A=["popover"];function Z(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div",27)(1,"button",28),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.oneClickBind())}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}if(2&o){const n=e.oxw(2);e.xp6(1),e.Q6J("disabled",!n.params.nickName||n.isLoading),e.xp6(1),e.hij(" ",e.lcZ(3,2,"1-click-bind")," ")}}function T(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div",29)(1,"div",30),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.isShowManualBind=!i.isShowManualBind)}),e._uU(2),e.ALo(3,"translate"),e._UZ(4,"i",31),e.qZA()()}if(2&o){const n=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,2,"Can't Bind Account")," "),e.xp6(2),e.Q6J("ngClass",n.isShowManualBind?"rotate-90":"-rotate-90")}}function b(o,r){1&o&&(e.TgZ(0,"div",32)(1,"div",9),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"div",33),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"Manual Bind")," "))}function K(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div")(1,"div",9)(2,"div"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",13)(6,"ion-input",14),e.NdJ("ngModelChange",function(i){e.CHM(n);const s=e.oxw(2);return e.KtG(s.accountOptKey.passphrase=i)})("ionChange",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.verifyInfo())}),e.ALo(7,"translate"),e.qZA()()()}if(2&o){const n=r.$implicit,t=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,3,n.i18n)),e.xp6(3),e.Q6J("placeholder",e.lcZ(7,5,n.i18n))("ngModel",t.accountOptKey.passphrase)}}function y(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"div",6),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-icon",7),e.NdJ("click",function(){e.CHM(n),e.oxw();const i=e.MAs(1);return e.KtG(i.dismiss())}),e.qZA()(),e.TgZ(6,"div",8)(7,"div",9),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"button",10),e.NdJ("click",function(i){e.CHM(n);const s=e.oxw();return e.KtG(s.handleSelectOpen(i))}),e._UZ(11,"img",11)(12,"ion-icon",12),e.qZA(),e.TgZ(13,"div",9)(14,"div"),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"div",13)(18,"ion-input",14),e.NdJ("ngModelChange",function(i){e.CHM(n);const s=e.oxw();return e.KtG(s.params.nickName=i)})("ionChange",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.verifyInfo())}),e.ALo(19,"translate"),e.qZA()(),e.YNc(20,Z,4,4,"div",15),e.YNc(21,T,5,4,"div",16),e.TgZ(22,"div",17),e.YNc(23,b,5,3,"div",18),e.TgZ(24,"div",19)(25,"div"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"div",20),e._uU(29),e.ALo(30,"translate"),e._UZ(31,"ion-icon",21),e.qZA()(),e.TgZ(32,"div",13)(33,"ion-input",14),e.NdJ("ngModelChange",function(i){e.CHM(n);const s=e.oxw();return e.KtG(s.params.apiKey=i)})("ionChange",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.verifyInfo())}),e.ALo(34,"translate"),e.qZA(),e._UZ(35,"ion-icon",22),e.qZA(),e.TgZ(36,"div",9)(37,"div"),e._uU(38),e.ALo(39,"translate"),e.qZA()(),e.TgZ(40,"div",13)(41,"ion-input",14),e.NdJ("ngModelChange",function(i){e.CHM(n);const s=e.oxw();return e.KtG(s.params.apiSecret=i)})("ionChange",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.verifyInfo())}),e.ALo(42,"translate"),e.qZA(),e._UZ(43,"ion-icon",22),e.qZA(),e.YNc(44,K,8,7,"div",23),e.TgZ(45,"div",24)(46,"button",25),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.handleDismiss())}),e._uU(47),e.ALo(48,"translate"),e.qZA(),e.TgZ(49,"button",26),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.connectExchange())}),e._uU(50),e.ALo(51,"translate"),e.qZA()()()()()}if(2&o){const n=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,23,"connect-exchange")," "),e.xp6(5),e.Oqu(e.lcZ(9,25,"select-exchange")),e.xp6(3),e.ekj("filter","okx"===n.exchanges[n.selectedExchange].exchange&&"dark"!==n.theme),e.Q6J("src",n.exchanges[n.selectedExchange].logo,e.LSH),e.xp6(4),e.Oqu(e.lcZ(16,27,"nickname")),e.xp6(3),e.Q6J("placeholder",e.lcZ(19,29,"name-this-account"))("ngModel",n.params.nickName),e.xp6(2),e.Q6J("ngIf",n.showOneClickBindBtn),e.xp6(1),e.Q6J("ngIf",n.showOneClickBindBtn),e.xp6(1),e.Q6J("ngClass",n.isShowManualBind||!n.showOneClickBindBtn?"h-auto":"h-0"),e.xp6(1),e.Q6J("ngIf",n.showOneClickBindBtn),e.xp6(3),e.Oqu(e.lcZ(27,31,"api-key")),e.xp6(3),e.hij(" ",e.lcZ(30,33,"how-to-find-api-key")," "),e.xp6(4),e.Q6J("placeholder",e.lcZ(34,35,"API Key"))("ngModel",n.params.apiKey),e.xp6(5),e.Oqu(e.lcZ(39,37,"api-secret")),e.xp6(3),e.Q6J("placeholder",e.lcZ(42,39,"api-secret"))("ngModel",n.params.apiSecret),e.xp6(3),e.Q6J("ngForOf",n.exchanges[n.selectedExchange].accountOptKey),e.xp6(3),e.hij(" ",e.lcZ(48,41,"cancel")," "),e.xp6(2),e.Q6J("disabled",n.invalid||n.isLoading),e.xp6(1),e.hij(" ",e.lcZ(51,43,"exchange-connection")," ")}}function w(o,r){if(1&o&&e._UZ(0,"img",40),2&o){const n=e.oxw().$implicit,t=e.oxw(2);e.Tol("okx"===n.exchange&&"dark"!==t.theme?"h-7 filter":"h-7"),e.Q6J("src",n.logo,e.LSH)("alt",n.name)}}function D(o,r){1&o&&e._UZ(0,"div",41)}function k(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"ion-item",36),e.NdJ("click",function(){const s=e.CHM(n).index,f=e.oxw(2);return e.KtG(f.changeValue(s))}),e.TgZ(1,"ion-label")(2,"div",37),e.YNc(3,w,1,4,"img",38),e.YNc(4,D,1,0,"div",39),e.TgZ(5,"div",9),e._uU(6),e.qZA()()()()}if(2&o){const n=r.$implicit;e.xp6(3),e.Q6J("ngIf",n.isShow),e.xp6(1),e.Q6J("ngIf",!n.isShow),e.xp6(2),e.Oqu(n.name)}}function P(o,r){if(1&o&&(e.TgZ(0,"ion-list",34),e.YNc(1,k,7,3,"ion-item",35),e.qZA()),2&o){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.exchanges)}}let U=(()=>{class o extends l.u{constructor(n,t,i,s){super(),this.themeService=n,this.ExchangeService=t,this.loadingController=i,this.activatedRoute=s,this.notifyParentEvent=new e.vpe,this.isMenuOpen=!1,this.isShowManualBind=!1,this.selectedExchange=0,this.exchanges=[],this.accountOptKey={passphrase:""},this.params={nickName:"",apiKey:"",apiSecret:""},this.invalid=!0,this.isLoading=!1,this.OKEXOAuthSDK=window.OKEXOAuthSDK,this.getExchangeQuery()}ngOnInit(){this.OKEXOAuthSDK.init({requestUrl:"https://www.okex.com",onInit:()=>{console.log("OKEXOAuthSDK init success")}})}get theme(){return this.themeService._theme}get showOneClickBindBtn(){return!!this.exchanges[this.selectedExchange].oauth_cid&&this.OKEXOAuthSDK}handleSelectOpen(n){this.popover.event=n,this.isMenuOpen=!0}hasAllValues(n){console.log(n);for(let t in n)if(""===n[t])return!1;return!0}getExchangeQuery(){this.ExchangeService.exchangeQuery().pipe().subscribe(n=>(0,_.mG)(this,void 0,void 0,function*(){if(0===n.code)return this.exchanges=[],void n.data.forEach(t=>{this.exchanges.push({logo:t.icon,name:t.name,kind:t.kind,exchange:t.exchange,accountOptKey:JSON.parse(t.accountOptKey),oauth_cid:t.oauth_cid,isShow:-1===this.exchanges.findIndex(i=>i.exchange===t.exchange)})})}))}changeValue(n){this.selectedExchange=n}verifyInfo(){this.invalid=!this.hasAllValues(this.params)||this.selectedExchange>1&&!this.hasAllValues(this.accountOptKey)}connectExchange(){return(0,_.mG)(this,void 0,void 0,function*(){this.isLoading||(this.isLoading=!0,yield(yield this.loadingController.create()).present(),this.ExchangeService.bindingExchange({exchange:this.exchanges[this.selectedExchange].exchange,kind:this.exchanges[this.selectedExchange].kind,nickname:this.params.nickName,apiKey:this.params.apiKey,apiSecret:this.params.apiSecret,optKey:JSON.stringify(this.accountOptKey)}).pipe().subscribe(t=>(0,_.mG)(this,void 0,void 0,function*(){0===t.code?(this.toast.toastSuccess("\u7ed1\u5b9a\u6210\u529f"),this.notifyParentEvent.emit(!0)):this.toast.toastError("\u7ed1\u5b9a\u5931\u8d25")})).add(()=>{this.isLoading=!1,this.loadingController.dismiss()}))})}oneClickBind(){var n;const t=this.router.url.split("?")[0],i=null===(n=this.activatedRoute)||void 0===n?void 0:n.snapshot.queryParams,s=this.exchanges[this.selectedExchange],f=this.router.createUrlTree([t],{queryParams:Object.assign(Object.assign({},i),{provider:s.exchange,nick_name:this.params.nickName})}),v=this.OKEXOAuthSDK.generateState();localStorage.setItem(v,f.toString()),this.OKEXOAuthSDK.authorize({response_type:"code",access_type:"offline",client_id:s.oauth_cid,redirect_uri:encodeURIComponent("https://www.ottogo.com/oauth/okx"),scope:"fast_api",state:v})}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(m.f),e.Y36(M.O),e.Y36(c.HT),e.Y36(C.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-connect-exchange-modal"]],viewQuery:function(n,t){if(1&n&&e.Gf(A,5),2&n){let i;e.iGM(i=e.CRH())&&(t.popover=i.first)}},outputs:{notifyParentEvent:"notifyParentEvent"},standalone:!0,features:[e.qOj,e.jDz],decls:6,vars:3,consts:[[1,"theme-modal",3,"isOpen","didDismiss"],["modal",""],["side","bottom","alignment","center",1,"theme-popover",3,"isOpen","dismissOnSelect","didDismiss"],["popover",""],[1,"p-4"],[1,"flex","items-center","mb-4"],[1,"flex-1","text-2xl","text-text-strong","font-medium"],["name","close-outline",1,"w-10","h-10","cursor-pointer",3,"click"],[1,"font-medium"],[1,"text-text-strong"],[1,"w-full","border-solid","cursor-pointer","h-10","rounded-md","border-border-input","border","flex","items-center","justify-between","bg-bg-input","px-2","mb-4",3,"click"],["alt","exchanges[selectedExchange].name",1,"h-6","pointer-events-none",3,"src"],["name","chevron-down-outline",1,"pointer-events-none"],[1,"h-10","rounded-md","border-border-input","border","flex","items-center","bg-bg-input","px-2","mb-4"],[1,"",3,"placeholder","ngModel","ngModelChange","ionChange"],["class","flex justify-center",4,"ngIf"],["class","space-x-3 mb-4",4,"ngIf"],[1,"transform","overflow-hidden",3,"ngClass"],["class","flex items-center space-x-3 mb-4",4,"ngIf"],[1,"text-text-strong","flex","justify-between"],[1,"text-main-blue","text-xs","items-center","flex"],["name","help-circle-outline",1,"fill-main-blue","ml-1","w-6","h-6"],["name","qr-code-outline","size","large",1,"text-grey-2"],[4,"ngFor","ngForOf"],[1,"flex","justify-between"],[1,"border","border-solid","rounded","border-main-border","bg-grey-4","px-4","py-2","text-lg","text-text-strong",3,"click"],[1,"btn-blue","border","text-lg","font-medium","px-4","py-2","rounded",3,"disabled","click"],[1,"flex","justify-center"],["appRippleEffect","",1,"btn-blue","border","border-solid","border-accent-blue","text-lg","font-medium","px-4","py-2","rounded","mb-4","w-full",3,"disabled","click"],[1,"space-x-3","mb-4"],[1,"text-text-strong","text-center","cursor-pointer",3,"click"],[1,"transform","icon-chevronleft","font-bold","inline-block",3,"ngClass"],[1,"flex","items-center","space-x-3","mb-4"],[1,"flex-1","border","border-main-border"],["lines","full"],["class","cursor-pointer","lines","none",3,"click",4,"ngFor","ngForOf"],["lines","none",1,"cursor-pointer",3,"click"],[1,"flex","items-center","justify-between"],[3,"class","src","alt",4,"ngIf"],["class","h-7",4,"ngIf"],[3,"src","alt"],[1,"h-7"]],template:function(n,t){1&n&&(e.TgZ(0,"ion-modal",0,1),e.NdJ("didDismiss",function(){return t.handleDismiss()}),e.YNc(2,y,52,45,"ng-template"),e.qZA(),e.TgZ(3,"ion-popover",2,3),e.NdJ("didDismiss",function(){return t.isMenuOpen=!1}),e.YNc(5,P,2,1,"ng-template"),e.qZA()),2&n&&(e.Q6J("isOpen",t.isOpen),e.xp6(3),e.Q6J("isOpen",t.isMenuOpen)("dismissOnSelect",!0))},dependencies:[d.ez,d.mk,d.sg,d.O5,g.UX,g.JJ,g.u5,g.On,p.aw,p.X$,c.Pc,c.gu,c.pK,c.Ie,c.Q$,c.q_,c.ki,c.d8,c.j9,x.T,O.R,u.Q],styles:["ion-modal[_ngcontent-%COMP%]{--width: 400px;--height: auto;--padding-start: 8px;--padding-end: 8px}ion-item[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;--inner-padding-start: 10px;--inner-padding-end: 10px}ion-input[_ngcontent-%COMP%]{--padding-top: 8px;--padding-bottom: 8px}.filter[_ngcontent-%COMP%]{filter:invert(100%)}ion-popover.theme-popover[_ngcontent-%COMP%]::part(content), ion-popover.select-popover[_ngcontent-%COMP%]::part(content){--width: 270px;border-radius:5px;border-width:1px;border-style:solid;border-color:var(--main-border)}"]}),o})()},2472:(E,h,a)=>{a.d(h,{O:()=>g});var _=a(2340),d=a(4650),e=a(529);let g=(()=>{class c{constructor(l){this.http=l}exchangeQuery(){return this.http.get(`${_.N.BASE_URL}/user/exchange/query`)}queryBinding(l,u,x,m){return this.http.get(`${_.N.BASE_URL}/user/exchange/queryBinding?page=${l}&rows=${u}&exchange=${x}&kind=${m}`)}bindingExchange(l){return this.http.post(`${_.N.BASE_URL}/user/exchange/binding`,l)}unbinding(l){return this.http.post(`${_.N.BASE_URL}/user/exchange/unbinding`,l)}}return c.\u0275fac=function(l){return new(l||c)(d.LFG(e.eN))},c.\u0275prov=d.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);